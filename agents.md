# ECU Monitor 專案 - AI 程式碼生成代理設定

## 專案背景
- **專案名稱**: ECU-1051 工業設備智慧監控系統
- **主要功能**: 工業設備監控、AI 異常檢測、實時儀表板、預測性維護
- **部署環境**: 工業網路環境，支援 4 台 ECU-1051 設備同時監控
- **核心技術**: Python、Dash、Prometheus、Modbus TCP/IP、機器學習

## 技術棧配置

### 後端技術
- **主要語言**: Python 3.8+
- **Web 框架**: Dash (基於 Flask)
- **數據處理**: Pandas, NumPy
- **機器學習**: Scikit-learn (Isolation Forest, Linear Regression)
- **時間序列數據庫**: Prometheus
- **工業通訊**: Modbus TCP/IP
- **數據視覺化**: Plotly

### 前端技術
- **UI 框架**: Dash (Python Web Apps)
- **圖表庫**: Plotly.js
- **響應式設計**: 支援多種螢幕尺寸
- **實時更新**: dcc.Interval 組件

### 基礎設施
- **監控**: Prometheus + Modbus Exporter
- **部署**: Docker, systemd service
- **反向代理**: Nginx
- **備份**: 自動化腳本

## 程式碼規範

### Python 編碼標準
- **程式碼格式**: Black formatter (88 字元行寬)
- **語法檢查**: Flake8
- **類型檢查**: MyPy (漸進式類型提示)
- **文檔字串**: Google style docstrings
- **註解語言**: 正體中文
- **變數命名**: snake_case (Python), camelCase (JavaScript)

### 錯誤處理
- **必須包含**: 完整的 try-catch 錯誤處理
- **超時處理**: 所有網路請求必須設定 timeout
- **重試機制**: 關鍵操作需要重試邏輯
- **記錄**: 使用 logging 模組記錄錯誤和警告
- **優雅降級**: 服務不可用時提供備用方案

### 效能最佳化
- **資料庫查詢**: 使用批次查詢，避免 N+1 問題
- **記憶體管理**: 大數據集使用 chunked processing
- **快取策略**: 使用適當的快取機制 (TTL: 5-10分鐘)
- **連線池**: 使用連線池管理資料庫連線
- **異步處理**: 耗時操作使用背景任務

## 專案特定規則

### 檔案結構規範
```
專案根目錄/
├── 核心系統檔案/          # 主要業務邏輯
├── 儀表板系統/           # Dash 應用程式
├── 數據客戶端/           # Prometheus 客戶端
├── 診斷工具集/           # 維護和診斷工具
├── 配置檔案/            # JSON 配置檔案
├── 安裝與部署/          # 自動化腳本
└── 測試檔案/            # 單元測試和整合測試
```

### 配置檔案規範
- **格式**: JSON，支援註解（使用 jsonc）
- **結構**: 分離設備配置、指標配置、系統配置
- **驗證**: 配置載入時進行格式驗證
- **備份**: 自動備份原配置檔案

### Dash 應用程式規範
- **元件命名**: 使用描述性 ID (device-selector, metric-graph)
- **回調函數**: 明確的輸入輸出參數
- **狀態管理**: 使用 dcc.Store 進行客戶端狀態管理
- **更新頻率**: 預設 5-8 秒間隔，可配置
- **錯誤展示**: 友善的錯誤訊息和載入狀態

### 工業數據處理
- **單位轉換**: 必須包含單位和比例因子
- **數據驗證**: 檢查數據範圍和有效性
- **異常值處理**: 使用統計方法處理異常值
- **時間同步**: 確保時間戳的一致性
- **精度保持**: 浮點數計算保持適當精度

## AI 功能規範

### 異常檢測
- **演算法**: Isolation Forest (contamination=0.01)
- **訓練數據**: 最少 100 個數據點
- **特徵選擇**: 選擇關鍵工業指標 (溫度、電流、壓力)
- **模型更新**: 每日自動重新訓練
- **閾值設定**: 可配置的異常分數閾值

### 趨勢預測
- **演算法**: 線性回歸 + 移動平均
- **預測範圍**: 未來 10-30 個時間點
- **置信度**: 計算預測置信區間
- **更新頻率**: 每小時更新預測模型
- **視覺化**: 預測曲線與歷史數據對比

### 健康評分
- **評分範圍**: 0-100 分
- **權重分配**: 溫度 40%、電流 30%、其他 30%
- **等級劃分**: 優秀(90+)、良好(70-89)、需關注(<70)
- **更新間隔**: 即時計算，每 5 秒更新

## 安全性要求

### 數據安全
- **敏感數據**: 加密儲存設備 IP 和認證資訊
- **傳輸安全**: 使用 HTTPS (生產環境)
- **存取控制**: 實作 RBAC (基於角色的存取控制)
- **審計記錄**: 記錄所有配置變更和關鍵操作

### 系統安全
- **輸入驗證**: 驗證所有外部輸入
- **SQL 注入**: 使用參數化查詢
- **XSS 防護**: 過濾和轉義用戶輸入
- **CSRF 防護**: 使用 CSRF token

## 部署和維護

### Docker 化
- **基礎映像**: python:3.9-slim
- **多階段建置**: 分離建置和執行環境
- **健康檢查**: 實作 /health 端點
- **資源限制**: 設定記憶體和 CPU 限制

### 監控和維護
- **健康檢查**: 系統狀態監控
- **效能監控**: CPU、記憶體、網路使用率
- **日誌管理**: 輪轉日誌，保留 30 天
- **自動備份**: 每日備份配置和重要數據

## 測試要求

### 單元測試
- **覆蓋率**: 最少 80% 程式碼覆蓋率
- **測試框架**: pytest
- **模擬**: 使用 unittest.mock 模擬外部依賴
- **測試數據**: 使用固定的測試數據集

### 整合測試
- **端到端**: 使用 Selenium 測試 Web 界面
- **API 測試**: 測試所有 REST API 端點
- **負載測試**: 模擬多用戶同時存取
- **故障測試**: 測試異常情況的處理

## 程式碼生成規則

### 自動生成內容
1. **完整實作**: 提供可直接執行的完整程式碼
2. **深度思考**: 考慮邊緣情況和錯誤處理
3. **最佳實踐**: 遵循工業級程式碼標準
4. **文檔完整**: 包含詳細的 docstring 和註解
5. **測試友善**: 程式碼結構便於測試

### 禁止項目
- **硬編碼**: 避免硬編碼配置值
- **全域變數**: 避免使用全域變數
- **同步阻塞**: 避免長時間的同步操作
- **未處理異常**: 所有可能的異常都要處理
- **不安全實作**: 避免安全漏洞

### 優先採用技術
- **配置驅動**: 使用配置檔案而非硬編碼
- **依賴注入**: 使用依賴注入模式
- **工廠模式**: 用於建立複雜物件
- **觀察者模式**: 用於事件處理
- **策略模式**: 用於演算法選擇

## 特殊要求

### 工業環境適應
- **網路不穩定**: 實作斷線重連機制
- **24/7 運行**: 確保系統穩定性
- **資源限制**: 優化資源使用
- **維護友善**: 提供豐富的診斷工具

### 用戶體驗
- **中文界面**: 使用正體中文
- **直觀操作**: 簡潔易懂的操作界面
- **即時反饋**: 操作結果即時顯示
- **錯誤處理**: 友善的錯誤訊息

### 擴展性設計
- **模組化**: 功能模組化設計
- **插件機制**: 支援功能擴展
- **API 設計**: 提供 REST API
- **配置靈活**: 支援多種部署場景

---

## 使用說明

此 agents.md 檔案應該放置在專案根目錄，作為 AI 程式碼生成的參考規範。在請求 AI 協助時，請明確提及：

1. 要遵循此配置檔案的規則
2. 指定具體的功能需求
3. 說明預期的輸出格式

AI 將根據這些規則生成符合專案標準的高品質程式碼。